<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png"><link rel="icon" href="/assets/images/favicon.ico"><title>Build Typescript libraries for the browser with Nx</title><meta name="description" content="Bite-sized resources for Angular and its ecosystem"><meta name="author" content="Giancarlo Buomprisco"><meta property="og:title" content="Build Typescript libraries for the browser with Nx"><meta property="og:description" content="Bite-sized resources for Angular and its ecosystem"><meta property="og:locale" content="en"><meta property="og:site_name" content="Angular Bites"><link href="/assets/styles/main.5faac527bf623130d0ec.css" rel="stylesheet"></head><body><div class="container mx-auto pt-8"><header class="flex"><div class="align-items"><a href="/" class="logo"><img alt="Logo" src="/assets/images/logo.png"></a></div><div class="ml-5"><h1 class="text-4xl my-0"><a class="font-bold site-name" href="/">Angular Bites</a></h1><h2 class="text-lg mb-8 text-gray-800 font-sans">Bite-sized resources for Angular and its ecosystem</h2></div></header><article class="post pt-4"><header class="mb-6"><h1 class="text-5xl">Build Typescript libraries for the browser with Nx</h1><div class="flex items-center"><div class="user-image flex items-center"><a target="_blank" href="https://twitter.com/@gc_psk" class="flex items-center"><img src="/assets/images/giancarlo.jpeg"> <span class="ml-2 text-gray-600 text-sm">@gc_psk</span> </a><span class="text-gray-600 text-400 ml-1">/ July 25, 2020</span></div><div class="ml-5"><a href="/tags/typescript" class="tag-item text-xs">typescript </a><a href="/tags/nx" class="tag-item text-xs">nx</a></div></div></header><section class="pb-3"><p>I have quite a few libraries in my Nx workspaces, and most of them are built using their tooling (Angular, Stencil).</p><p>Also, I have a few vanilla Typescript libraries that need to be consumed within a Browser environment. Originally, I used to bundle them with the builder <code>@nrwl/web:bundle</code> - which got deprecated with Nx 9.</p><p>I needed to find another way.</p><p>The best way I found to achieve an even better result is by using the builder <code>@nrwl/node:build</code>, extended with a Webpack configuration.</p><h2>Configuration</h2><p>Here's the configuration that I use to build browser-compatible distributions of my library <code>sdk</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"sdk"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"root"</span><span class="token operator">:</span> <span class="token string">"libs/sdk"</span><span class="token punctuation">,</span><br>  <span class="token property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/src"</span><span class="token punctuation">,</span><br>  <span class="token property">"projectType"</span><span class="token operator">:</span> <span class="token string">"library"</span><span class="token punctuation">,</span><br>  <span class="token property">"schematics"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"architect"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"builder"</span><span class="token operator">:</span> <span class="token string">"@nrwl/node:build"</span><span class="token punctuation">,</span><br>      <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"outputPath"</span><span class="token operator">:</span> <span class="token string">"dist/sdk"</span><span class="token punctuation">,</span><br>        <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/src/index.ts"</span><span class="token punctuation">,</span><br>        <span class="token property">"tsConfig"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/tsconfig.lib.json"</span><span class="token punctuation">,</span><br>        <span class="token property">"project"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/package.json"</span><span class="token punctuation">,</span><br>        <span class="token property">"webpackConfig"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/webpack.config.js"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"production"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>          <span class="token property">"fileReplacements"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>            <span class="token punctuation">{</span><br>              <span class="token property">"replace"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/src/environments/environment.ts"</span><span class="token punctuation">,</span><br>              <span class="token property">"with"</span><span class="token operator">:</span> <span class="token string">"libs/sdk/src/environments/environment.prod.ts"</span><br>            <span class="token punctuation">}</span><br>          <span class="token punctuation">]</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><h3>Webpack configuration</h3><p>As you may have noticed, I have also supplied a Webpack configuration file. It's needed, as we want to tell Webpack to produce a browser bundle.</p><p>Also, we can extend the configuration with any plugin we want. For example, I used Terser to optimize the size of the output.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span>config<span class="token punctuation">,</span><br>    externals<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    target<span class="token operator">:</span> <span class="token string">"web"</span><span class="token punctuation">,</span><br>    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token operator">...</span>config<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span><br>      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>        parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span><br>          ecma<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    devtool<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>    output<span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token operator">...</span>config<span class="token punctuation">.</span>output<span class="token punctuation">,</span><br>      filename<span class="token operator">:</span> <span class="token string">'sdk.umd.js'</span><span class="token punctuation">,</span><br>      libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3>Bundling the Typescript library</h3><p>In order to bundle the library, I run the following command:</p><pre><code>&gt; ng run sdk:build
Starting type checking service...
Using 10 workers with 2048MB memory limit
Hash: c02b92c803ac182c3da8
Built at: 07/26/2020 1:00:34 AM
Entrypoint main = sdk.umd.js
chunk    {0} sdk.umd.js (main) 35.3 KiB [entry] [rendered]

———————————————————————————————————————————————

&gt;  NX   SUCCESS  Running target &quot;build&quot; succeeded
</code></pre><hr><p><em>If you enjoyed this article, follow me on <a href="https://twitter.com/gc_psk">Twitter</a></em></p></section><div><script async data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div class="text-sm">Do you want to report something incorrect? Please open an Issue or a PR on <a class="underline" href="https://github.com/Gbuomprisco/angularbites.com">Github</a></div><footer class="mt-5 pb-5 mb-10"><a class="underline" href="/">Back to home</a></footer></article></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-172483071-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172483071-1")</script><script src="https://zedform-sdk.web.app/tracking-sdk.umd.js"></script><script src="https://zedform-sdk.web.app/sdk.umd.js" async data-formtoro></script><div data-formtoro-form="10844c24-0314-4c31-8272-9e00dafdd0ec"></div><link href="https://fonts.googleapis.com/css2?family=Martel:wght@400;700;800&display=swap" rel="stylesheet"></body></html>